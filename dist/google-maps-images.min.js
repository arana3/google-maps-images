"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}function makeStaticMapMarkerCollection(t){return new StaticMapMarkerCollection(t)}function convertJsonStylersToRules(t){var e=/^#([0-9a-f]{6})$/i,a={};return t.forEach(function(t){var r=Object.keys(t)[0],i=String(t[r]),n=i.match(e);Array.isArray(n)&&(i="0x"+n[1]),a[r]=i}),a}function makeStaticMapStyle(){return new StaticMapStyle}function generateSignature(t,e){var a=new UrlParse(t),r=a.pathname+a.query,i=new Buffer(e,"base64"),n=crypto.createHmac("sha1",i).update(r).digest("base64"),s=base64Url.escape(n);return s}function makeStaticMap$1(t,e){return new StaticMap(t,e)}Object.defineProperty(exports,"__esModule",{value:!0});var queryString=_interopDefault(require("query-string")),base64Url=_interopDefault(require("base64-url")),buffer=_interopDefault(require("buffer/")),crypto=_interopDefault(require("crypto")),UrlParse=_interopDefault(require("url-parse")),classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),_extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},get=function t(e,a,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,a);if(void 0===i){var n=Object.getPrototypeOf(e);return null===n?void 0:t(n,a,r)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},set=function t(e,a,r,i){var n=Object.getOwnPropertyDescriptor(e,a);if(void 0===n){var s=Object.getPrototypeOf(e);null!==s&&t(s,a,r,i)}else if("value"in n&&n.writable)n.value=r;else{var o=n.set;void 0!==o&&o.call(i,r)}return r},toConsumableArray=function(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)},StaticMapLocation=function(){function t(e){classCallCheck(this,t),this.location=e}return createClass(t,[{key:"toString",value:function(){return this.location}}],[{key:"fromLatLng",value:function(e,a){return new t(e+","+a)}},{key:"fromAddress",value:function(e){return new t(e)}}]),t}(),StaticMapMarkerCollection=function(){function t(e){classCallCheck(this,t),this.locations=e,this.styles={}}return createClass(t,[{key:"toString",value:function(){var t=this,e=Object.keys(this.styles).map(function(e){return e+":"+t.styles[e]}),a=this.locations.map(function(t){return t.toString()}),r=[].concat(toConsumableArray(e),toConsumableArray(a));return r.join("|")}},{key:"sizeTiny",value:function(){return this.styles.size="tiny",this}},{key:"sizeMid",value:function(){return this.styles.size="mid",this}},{key:"sizeSmall",value:function(){return this.styles.size="small",this}},{key:"color",value:function(t){return this.styles.color=t,this}},{key:"label",value:function(t){return this.styles.label=t,this}},{key:"icon",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.styles.icon=encodeURI(t),e&&(this.styles.scale="2"),this}}]),t}(),StaticMapStyle=function(){function t(){classCallCheck(this,t),this.params={feature:"",element:"",rules:{}}}return createClass(t,[{key:"toString",value:function(){var t=_extends({feature:this.params.feature,element:this.params.element},this.params.rules),e=Object.keys(t).map(function(e){return e+":"+t[e]});return e.join("|")}},{key:"feature",value:function(t){return this.params.feature=t,this}},{key:"element",value:function(t){return this.params.element=t,this}},{key:"rules",value:function(t){return this.params.rules=t,this}}],[{key:"fromJsonStyleObject",value:function(e){return(new t).feature(e.featureType).element(e.elementType).rules(convertJsonStylersToRules(e.stylers))}}]),t}(),Buffer=buffer.Buffer,BASE_URL_STATICMAP="https://maps.googleapis.com/maps/api/staticmap?",StaticMap=function(){function t(e,a){classCallCheck(this,t),this.params={size:e+"x"+a},this.markerCollections=[],this.visibleLocations=[],this.styles=[],this.auth=null}return createClass(t,[{key:"generateUrl",value:function(){var t=_extends({},this.params,{markers:this.markerCollections.map(function(t){return t.toString()}),style:this.styles.map(function(t){return t.toString()})});if(this.visibleLocations.length>0&&(t.visible=this.visibleLocations.map(function(t){return t.toString()}).join("|")),null===this.auth)throw new Error("No authentication");switch(this.auth.type){case"apiKey":t.key=this.auth.apiKey;break;case"client":t.client=this.auth.clientId}var e=BASE_URL_STATICMAP+queryString.stringify(t);return null!==this.auth&&"client"===this.auth.type&&(e+="&signature="+generateSignature(e,this.auth.clientSecret)),e}},{key:"centerLatLng",value:function(t,e){return this.params.center=StaticMapLocation.fromLatLng(t,e).toString(),this}},{key:"centerAddress",value:function(t){return this.params.center=StaticMapLocation.fromAddress(t).toString(),this}},{key:"zoom",value:function(t){return this.params.zoom=String(t),this}},{key:"doubleScale",value:function(){return this.params.scale="2",this}},{key:"pngFormat",value:function(){return this.params.format="png",this}},{key:"jpegFormat",value:function(){return this.params.format="jpg",this}},{key:"maptypeRoadmap",value:function(){return this.params.maptype="roadmap",this}},{key:"maptypeSatellite",value:function(){return this.params.maptype="satellite",this}},{key:"maptypeTerrain",value:function(){return this.params.maptype="terrain",this}},{key:"maptypeHybrid",value:function(){return this.params.maptype="hybrid",this}},{key:"language",value:function(t){return this.params.language=t,this}},{key:"region",value:function(t){return this.params.region=t,this}},{key:"addMarkerCollections",value:function(t){return this.markerCollections=[].concat(toConsumableArray(this.markerCollections),toConsumableArray(t)),this}},{key:"addVisibleLocations",value:function(t){return this.visibleLocations=[].concat(toConsumableArray(this.visibleLocations),toConsumableArray(t)),this}},{key:"addStyles",value:function(t){return this.styles=[].concat(toConsumableArray(this.styles),toConsumableArray(t)),this}},{key:"addStylesFromJsonObjects",value:function(t){return this.addStyles(t.map(function(t){return StaticMapStyle.fromJsonStyleObject(t)})),this}},{key:"setApiKey",value:function(t){var e={type:"apiKey",apiKey:t};return this.auth=e,this}},{key:"setClientCredentials",value:function(t,e){var a={type:"client",clientId:t,clientSecret:e};return this.auth=a,this}}]),t}(),StaticMapAuthenticatedFactory=function(){function t(e){classCallCheck(this,t),this.makeStaticMapMarkerCollection=makeStaticMapMarkerCollection,this.makeStaticMapStyle=makeStaticMapStyle,this.StaticMap=StaticMap,this.StaticMapLocation=StaticMapLocation,this.StaticMapMarkerCollection=StaticMapMarkerCollection,this.StaticMapStyle=StaticMapStyle,this.auth=e}return createClass(t,[{key:"makeStaticMap",value:function(t,e){var a=new StaticMap(t,e);switch(this.auth.type){case"apiKey":a.setApiKey(this.auth.apiKey);break;case"client":a.setClientCredentials(this.auth.clientId,this.auth.clientSecret)}return a}}],[{key:"usingApiKey",value:function(e){var a={type:"apiKey",apiKey:e};return new t(a)}},{key:"usingClientCredentials",value:function(e,a){var r={type:"client",clientId:e,clientSecret:a};return new t(r)}}]),t}();exports.StaticMapAuthenticatedFactory=StaticMapAuthenticatedFactory,exports.StaticMapLocation=StaticMapLocation,exports.StaticMapMarkerCollection=StaticMapMarkerCollection,exports.makeStaticMapMarkerCollection=makeStaticMapMarkerCollection,exports.StaticMap=StaticMap,exports.makeStaticMap=makeStaticMap$1,exports.StaticMapStyle=StaticMapStyle,exports.makeStaticMapStyle=makeStaticMapStyle;
